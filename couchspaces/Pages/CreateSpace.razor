@page "/create-space"
@using Microsoft.AspNetCore.Components.Authorization
@using couchspaces.Services
@using System.Security.Claims
@inject NavigationManager NavigationManager
@inject SpaceService SpaceService
@inject AuthenticationStateProvider AuthStateProvider

<AuthorizeView>
    <Authorized>
        <MudContainer MaxWidth="MaxWidth.Medium">
            <MudPaper Class="pa-4">
                <MudText Typo="Typo.h4">Create a new space</MudText>
                <MudTextField @bind-Value="spaceName" Label="Space Name" Required="true" />
                <MudButton OnClick="CreateSpaceHandler" Variant="Variant.Filled" Disabled="@string.IsNullOrEmpty(spaceName)">
                    Create
                </MudButton>
            </MudPaper>
        </MudContainer>
    </Authorized>
    <NotAuthorized>
        <MudText Typo="Typo.h6">You are not authorized to create a space. Redirecting...</MudText>
        <MudAlert>Unauthorized</MudAlert>
    </NotAuthorized>
</AuthorizeView>

@code {
    [CascadingParameter] private Task<AuthenticationState> AuthStateTask { get; set; }
    private string spaceName = string.Empty;

    private void CreateSpaceHandler()
    {
        var space = SpaceService.CreateSpace(spaceName);
        // Navigate to the space page
        NavigationManager.NavigateTo($"/space/{space.Id}");
    }
}